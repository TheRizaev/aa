{% extends 'main/base.html' %}
{% load static %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - KRONIK{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/analytics.css' %}">
{% endblock %}

{% block content %}
<div class="analytics-container">
    <div class="analytics-header">
        <div class="header-content">
            <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–∞</h1>
            <div class="header-controls">
                <div class="date-range-selector">
                    <select id="dateRange" class="date-range-select">
                        <option value="7">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                        <option value="30" selected>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</option>
                        <option value="90">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</option>
                        <option value="365">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥</option>
                    </select>
                </div>
                <button class="export-button" id="exportData">
                    <span class="icon">üì•</span>
                    –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                </button>
                <button class="refresh-button" id="refreshData">
                    <span class="icon">üîÑ</span>
                    –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="analytics-loading" id="analyticsLoading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</h3>
            <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</p>
        </div>
    </div>

    <!-- Main Analytics Content -->
    <div class="analytics-content" id="analyticsContent" style="display: none;">
        
        <!-- Overview Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card views-card">
                <div class="stat-icon">üëÅÔ∏è</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalViews">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    <div class="stat-change" id="viewsChange">
                        <span class="change-icon">üìà</span>
                        <span class="change-value">+0%</span>
                    </div>
                </div>
            </div>

            <div class="stat-card subscribers-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalSubscribers">0</div>
                    <div class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                    <div class="stat-change" id="subscribersChange">
                        <span class="change-icon">üìà</span>
                        <span class="change-value">+0%</span>
                    </div>
                </div>
            </div>

            <div class="stat-card engagement-card">
                <div class="stat-icon">üíù</div>
                <div class="stat-content">
                    <div class="stat-value" id="engagementRate">0%</div>
                    <div class="stat-label">–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</div>
                    <div class="stat-change" id="engagementChange">
                        <span class="change-icon">üìà</span>
                        <span class="change-value">+0%</span>
                    </div>
                </div>
            </div>

            <div class="stat-card revenue-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalRevenue">‚ÇΩ0.00</div>
                    <div class="stat-label">–î–æ—Ö–æ–¥</div>
                    <div class="stat-change" id="revenueChange">
                        <span class="change-icon">üìà</span>
                        <span class="change-value">+0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <!-- Views Over Time Chart -->
            <div class="chart-container views-chart">
                <div class="chart-header">
                    <h3>üìà –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
                    <div class="chart-controls">
                        <button class="chart-control active" data-period="daily">–î–µ–Ω—å</button>
                        <button class="chart-control" data-period="weekly">–ù–µ–¥–µ–ª—è</button>
                        <button class="chart-control" data-period="monthly">–ú–µ—Å—è—Ü</button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="viewsChart"></canvas>
                </div>
            </div>

            <!-- Demographics Chart -->
            <div class="chart-container demographics-chart">
                <div class="chart-header">
                    <h3>üåç –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è –∑—Ä–∏—Ç–µ–ª–µ–π</h3>
                </div>
                <div class="chart-content">
                    <canvas id="demographicsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Additional Charts Row -->
        <div class="charts-grid">
            <!-- Engagement Chart -->
            <div class="chart-container engagement-chart">
                <div class="chart-header">
                    <h3>üíù –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</h3>
                </div>
                <div class="chart-content">
                    <canvas id="engagementChart"></canvas>
                </div>
            </div>

            <!-- Traffic Sources -->
            <div class="chart-container traffic-chart">
                <div class="chart-header">
                    <h3>üöÄ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞</h3>
                </div>
                <div class="chart-content">
                    <canvas id="trafficChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Detailed Tables Section -->
        <div class="tables-section">
            
            <!-- Top Videos Table -->
            <div class="table-container top-videos-table">
                <div class="table-header">
                    <h3>üèÜ –¢–æ–ø –≤–∏–¥–µ–æ</h3>
                    <button class="view-all-btn" id="viewAllVideos">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</button>
                </div>
                <div class="table-content">
                    <table class="analytics-table" id="topVideosTable">
                        <thead>
                            <tr>
                                <th>–í–∏–¥–µ–æ</th>
                                <th>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                <th>–õ–∞–π–∫–∏</th>
                                <th>–î–∏–∑–ª–∞–π–∫–∏</th>
                                <th>–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</th>
                                <th>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Engagement Metrics Table -->
            <div class="table-container engagement-metrics-table">
                <div class="table-header">
                    <h3>üìä –ú–µ—Ç—Ä–∏–∫–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                </div>
                <div class="table-content">
                    <table class="analytics-table" id="engagementMetricsTable">
                        <thead>
                            <tr>
                                <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
                                <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>
                                <th>–¢—Ä–µ–Ω–¥</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Activity Table -->
            <div class="table-container recent-activity-table">
                <div class="table-header">
                    <h3>‚ö° –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                </div>
                <div class="table-content">
                    <table class="analytics-table" id="recentActivityTable">
                        <thead>
                            <tr>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–°–æ–±—ã—Ç–∏–µ</th>
                                <th>–í–∏–¥–µ–æ</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Revenue Analytics (Premium Feature) -->
        <div class="revenue-section" id="revenueSection">
            <div class="section-header">
                <h2>üí∞ –ê–Ω–∞–ª–∏–∑ –¥–æ—Ö–æ–¥–æ–≤</h2>
                <div class="premium-badge">
                    <span class="badge-icon">üëë</span>
                    <span class="badge-text">Premium</span>
                </div>
            </div>
            
            <div class="revenue-grid">
                <div class="revenue-card total-revenue">
                    <div class="revenue-icon">üíé</div>
                    <div class="revenue-content">
                        <div class="revenue-amount" id="totalRevenueAmount">‚ÇΩ0.00</div>
                        <div class="revenue-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥</div>
                        <div class="revenue-period">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
                    </div>
                </div>

                <div class="revenue-card monthly-revenue">
                    <div class="revenue-icon">üìÖ</div>
                    <div class="revenue-content">
                        <div class="revenue-amount" id="monthlyRevenueAmount">‚ÇΩ0.00</div>
                        <div class="revenue-label">–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</div>
                        <div class="revenue-period">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
                    </div>
                </div>

                <div class="revenue-card estimated-revenue">
                    <div class="revenue-icon">üîÆ</div>
                    <div class="revenue-content">
                        <div class="revenue-amount" id="estimatedRevenueAmount">‚ÇΩ0.00</div>
                        <div class="revenue-label">–ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–∞</div>
                        <div class="revenue-period">–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü</div>
                    </div>
                </div>

                <div class="revenue-card cpm-rate">
                    <div class="revenue-icon">üìä</div>
                    <div class="revenue-content">
                        <div class="revenue-amount" id="cpmRate">‚ÇΩ0.00</div>
                        <div class="revenue-label">CPM</div>
                        <div class="revenue-period">–ó–∞ 1000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    </div>
                </div>
            </div>

            <div class="revenue-chart-container">
                <div class="chart-header">
                    <h3>üìà –î–∏–Ω–∞–º–∏–∫–∞ –¥–æ—Ö–æ–¥–æ–≤</h3>
                </div>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <!-- Video Performance Details -->
        <div class="performance-section" id="performanceSection">
            <div class="section-header">
                <h2>üéØ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h2>
            </div>
            
            <div class="performance-grid">
                <!-- Video Retention Chart -->
                <div class="performance-card retention-card">
                    <div class="card-header">
                        <h3>‚è±Ô∏è –£–¥–µ—Ä–∂–∞–Ω–∏–µ –∑—Ä–∏—Ç–µ–ª–µ–π</h3>
                        <select class="video-selector" id="retentionVideoSelector">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ...</option>
                        </select>
                    </div>
                    <div class="card-content">
                        <canvas id="retentionChart"></canvas>
                    </div>
                </div>

                <!-- Click-through Rate -->
                <div class="performance-card ctr-card">
                    <div class="card-header">
                        <h3>üéØ CTR –ø–æ –ø—Ä–µ–≤—å—é</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="ctrChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Growth Insights -->
        <div class="insights-section" id="insightsSection">
            <div class="section-header">
                <h2>üöÄ –ò–Ω—Å–∞–π—Ç—ã —Ä–æ—Å—Ç–∞</h2>
            </div>
            
            <div class="insights-grid">
                <div class="insight-card positive-insight">
                    <div class="insight-icon">‚úÖ</div>
                    <div class="insight-content">
                        <h3>–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ</h3>
                        <ul id="positiveInsights">
                            <li>–í—ã—Å–æ–∫–∞—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å –≤ –≤–∏–¥–µ–æ –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏</li>
                            <li>–°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</li>
                            <li>–•–æ—Ä–æ—à–µ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –∑—Ä–∏—Ç–µ–ª–µ–π</li>
                        </ul>
                    </div>
                </div>

                <div class="insight-card improvement-insight">
                    <div class="insight-icon">‚ö†Ô∏è</div>
                    <div class="insight-content">
                        <h3>–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è</h3>
                        <ul id="improvementInsights">
                            <li>–ù–∏–∑–∫–∏–π CTR –Ω–∞ –ø—Ä–µ–≤—å—é –≤–∏–¥–µ–æ</li>
                            <li>–ú–∞–ª–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–¥ –≤–∏–¥–µ–æ</li>
                            <li>–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫</li>
                        </ul>
                    </div>
                </div>

                <div class="insight-card recommendation-insight">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-content">
                        <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                        <ul id="recommendationInsights">
                            <li>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ–ª–µ–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–≤—å—é</li>
                            <li>–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Ü–µ –≤–∏–¥–µ–æ</li>
                            <li>–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –≤–∏–¥–µ–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Video Modal -->
    <div class="modal" id="videoDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ</h2>
                <button class="modal-close" id="closeVideoModal">&times;</button>
            </div>
            <div class="modal-body" id="videoDetailsContent">
                <!-- Video details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</h3>
                    <div class="format-options">
                        <label class="format-option">
                            <input type="radio" name="exportFormat" value="json" checked>
                            <span class="format-icon">üìÑ</span>
                            <span class="format-name">JSON</span>
                            <span class="format-desc">–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="exportFormat" value="csv">
                            <span class="format-icon">üìä</span>
                            <span class="format-name">CSV</span>
                            <span class="format-desc">–¢–∞–±–ª–∏—Ü–∞ –¥–ª—è Excel</span>
                        </label>
                    </div>
                    
                    <h3>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö:</h3>
                    <div class="period-options">
                        <select id="exportPeriod" class="export-select">
                            <option value="7">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                            <option value="30" selected>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</option>
                            <option value="90">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</option>
                            <option value="365">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥</option>
                            <option value="all">–í—Å–µ –≤—Ä–µ–º—è</option>
                        </select>
                    </div>
                </div>
                
                <div class="export-actions">
                    <button class="export-cancel-btn" id="cancelExport">–û—Ç–º–µ–Ω–∞</button>
                    <button class="export-confirm-btn" id="confirmExport">
                        <span class="icon">üì•</span>
                        –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Toast -->
<div class="toast" id="analyticsToast">
    <div class="toast-content">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="{% static 'js/analytics.js' %}"></script>
{% endblock %}